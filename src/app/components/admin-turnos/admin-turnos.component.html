<app-navbar></app-navbar>
<body>
    <div class="wrapper">
    <h2 class="welcome-message">Administra los Turnos</h2>
    <div class="container">
      <div class="row">
        <!-- Left Column: Form and Filters -->
        <div class="col-md-4">
          <!-- Generar Turnos Form -->
          <form class="row g-3 align-items-center" (ngSubmit)="generateShifts()">
            <div class="col-8">
              <div class="form-floating">
                <select id="professional" class="form-select" [(ngModel)]="licenseNumber" name="professional" required>
                  <option value="" disabled selected>Seleccione un Profesional</option>
                  <option *ngFor="let prof of professionals" [value]="prof.licenseNumber">{{ prof.name }} {{ prof.surname }}</option>
                </select>
                <label for="professional">Profesional</label>
                <div class="invalid-feedback">
                  <span *ngIf="!isNumeric(licenseNumber)">La matrícula debe ser numérica.</span>
                </div>
              </div>
            </div>
            <div class="col-4 d-flex align-items-end">
              <button type="submit" class="btn btn-success w-100">Generar Turnos</button>
            </div>
          </form>

          <!-- Filter and Sort Menu -->
          <div class="mt-4">
            <div class="row g-3">
              <div class="col-12">
                <strong for="filterStatus" class="form-label">Estado</strong>
                <select id="filterStatus" class="form-select" [(ngModel)]="filterCriteria.status"
                  (change)="onFilterChange()">
                  <option value="">Todos</option>
                  <option value="ocupado">ocupado</option>
                  <option value="disponible">disponible</option>
                </select>
              </div>
              <div class="col-12">
                <strong for="filterLicense" class="form-label">Matrícula</strong>
                <select id="filterLicense" class="form-select" [(ngModel)]="filterCriteria.licenseNumber" (change)="onFilterChange()">
                  <option value="">Todas las Matrículas</option>
                  <option *ngFor="let prof of professionals" [value]="prof.licenseNumber">{{ prof.licenseNumber }} - {{ prof.name }} {{ prof.surname }}
                  </option>
                </select>
              </div>
              <div class="col-12">
                <strong for="filterSpeciality" class="form-label">Especialidad</strong>
                <select id="filterSpeciality" class="form-select" [(ngModel)]="filterCriteria.speciality" (change)="onFilterChange()">
                  <option value="">Todas las Especialidades</option>
                  <option *ngFor="let spec of specialities" [value]="spec.description">{{ spec.description }}</option>
                </select>
              </div>
              <div class="col-12 custom-checkbox">
                <input type="checkbox" id="filterFutureDates" class="form-check-input"
                  [(ngModel)]="filterCriteria.futureDates" (change)="onFilterChange()">
                <strong class="form-check-label ms-2" for="filterFutureDates">Fechas Futuras</strong>
              </div>
              <div class="col-12">
                <strong for="sortByPrice" class="form-label">Ordenar por Precio</strong>
                <select id="sortByPrice" class="form-select" [(ngModel)]="filterCriteria.sortByPrice"
                  (change)="onFilterChange()">
                  <option value="">Ninguno</option>
                  <option value="asc">Ascendente</option>
                  <option value="desc">Descendente</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column: List of Shifts -->
        <div class="col-md-8">
          <div class="mat-elevation-z8">
            <mat-paginator [pageSizeOptions]="[10]" showFirstLastButtons aria-label="Select page of shifts"></mat-paginator>
            <table mat-table [dataSource]="dataSource" class="mat-table">

              <!-- License Number Column -->
              <ng-container matColumnDef="licenseProfessional">
                <th mat-header-cell *matHeaderCellDef> Matrícula </th>
                <td mat-cell *matCellDef="let shift"> {{shift.licenseProfessional.licenseNumber}} </td>
              </ng-container>

              <!-- Speciality Column -->
              <ng-container matColumnDef="speciality">
                <th mat-header-cell *matHeaderCellDef> Especialidad </th>
                <td mat-cell *matCellDef="let shift"> {{shift.licenseProfessional.speciality.description}} </td>
              </ng-container>

              <!-- Date Column -->
              <ng-container matColumnDef="dateShift">
                <th mat-header-cell *matHeaderCellDef> Fecha </th>
                <td mat-cell *matCellDef="let shift"> {{shift.dateShift}} </td>
              </ng-container>

              <!-- Hour Column -->
              <ng-container matColumnDef="hourShift">
                <th mat-header-cell *matHeaderCellDef> Hora </th>
                <td mat-cell *matCellDef="let shift"> {{shift.hourShift}} </td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef> Estado </th>
                <td mat-cell *matCellDef="let shift"> {{shift.status}} </td>
              </ng-container>

              <!-- Price Column -->
              <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef> Precio </th>
                <td mat-cell *matCellDef="let shift"> ${{shift.price}} </td>
              </ng-container>

              <!-- Patient Column -->
              <ng-container matColumnDef="dniPatient">
                <th mat-header-cell *matHeaderCellDef> Paciente </th>
                <td mat-cell *matCellDef="let shift"> {{shift.dniPatient}} </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
            <div *ngIf="dataSource.data.length === 0" class="alert alert-warning mt-3">
              No hay turnos que coincidan con los filtros aplicados.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body> 
<app-footer></app-footer>